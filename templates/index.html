<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <style>
        .wrapper {
            padding: 10px;
        }

        .grid-container {
            display: inline-grid;
            grid-template-columns: auto auto;
            column-gap: 300px;
            padding: 40px;
            padding-left: 200px;
            padding-top: 20px;
        }
    </style>
    <script src="/filesaver.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>

</head>

<body>
    <div class="grid-container">
        <div class="cv">
            <h1>File CV Uploads</h1>
            {{msg}}
            <br>
            <br>
            <form action="/home" method='POST' enctype='multipart/form-data'>
                <input type="file" name="file_name_cv" multiple>
                <input type="submit" value="Submit">
            </form>
        </div>
        <div class="jd">
            <h1>File JD Uploads</h1>
            {{msg}}
            <br>
            <br>
            <form action="/home" method='POST' enctype='multipart/form-data'>
                <input type="file" name="file_name_jd">
                <input type="submit" value="Submit">
            </form>
        </div>
    </div>
    
    <br>

    <div class="wrapper">
        <div class="profile">
            <table id="userdata" border="1">
                <thead>
                    <th>name</th>
                    <th>email</th>
                    <th>skill</th>
                    <th>education</th>
                    <th>experience</th>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="container mt-5 ">
        <pre id="json"></pre>
        <button class="btn btn-primary" onclick="downloadAsExcel()">download excel</button>
    </div>
    <script>
        info = ''
        $.ajax({
            dataType: "json",
            type: "GET",
            url: '/home',
            success: function (response) {
                info = response
                appendData(info)
            },
            error: function (response) {
                console.log("Fail to load");
            },
        }).done(function () { console.log(info) })

        function appendData(data) {
            for (let i = 0; i < data.length; i++) {
                var tblRow = "<tr>" + "<td>" + data[i].name + "</td>" +
                    "<td>" + data[i].email + "</td>" + "<td>" + data[i].skill + "</td>" + "<td>" + data[i].education + "</td>" + "<td>"
                    + data[i].experience + "</td>" + "</tr>"
                $(tblRow).appendTo("#userdata tbody");
            }
        };
        document.getElementById('json').innerHTML = JSON.stringify(info, undefined, 4);
        const EXCEL_TYPE = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';
        const EXCEL_EXTENSION = '.xlsx';

        function downloadAsExcel() {
            const workSheet = XLSX.utils.json_to_sheet(info);
            const workbook = {
                Sheets: {info: workSheet },
                SheetNames: ['data'],
            };
            
            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            console.log(excelBuffer);
            saveAsExcel(excelBuffer, 'myFile');
        }

        function saveAsExcel(buffer, fileName) {
            const data = new Blob([buffer], { type: EXCEL_TYPE });
            saveAs(data, fileName + '_export_' + new Date().getTime());
        }
    </script>

</body>

</html>